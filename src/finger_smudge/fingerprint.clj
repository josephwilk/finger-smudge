(ns finger-smudge.fingerprint
  (:require [clojure.pprint :refer (cl-format)])

  (import java.awt.image.BufferedImage
          javax.imageio.ImageIO
          java.io.File)
  )

(defn int->binary-string [int]
  (vec
   (map
    (fn [s] (Integer/parseInt (str (char s))))
    (clojure.string/replace (format "%32s"
                                    (Integer/toBinaryString 100))
                            #" "
                            "0"))))

(defn visualise [raw-fingerprint]
  (let [raw-ints (map
                  (fn [s] (Integer/parseInt s))
                  (clojure.string/split raw-fingerprint #","))
        binary-strings (flatten (map int->binary-string raw-ints))]

    ;;463x32
    (let [i (BufferedImage. 463 32 BufferedImage/TYPE_INT_ARGB)
          g (.createGraphics i)]

      (doseq [x (range 0 463)]
        (doseq [y (range 0 32)]
          (let [candidate (nth binary-strings (* x y))]
            (if (= candidate 1)
              (.setColor g (java.awt.Color/black))
              (.setColor g (java.awt.Color/white)))
            (.fillRect g (+ 0 x) (+ 0 y)  (+ 1 x) (+ 1 y)))))
      (ImageIO/write i "png"  (File. "test.png")))))

(comment
  ;;signed 32-bit integers
  (def raw-fingerprint
    "1880821880,-266731480,-264634072,-803339732,-799206860,-790875628,-796126704,-1064562128,-1064545737,-1064708490,-1047806218,-1029989930,-1025799986,-765814642,-763709298,1379645582,1914283210,1914216666,1914233049,1914359928,1897549864,1881026856,1885278508,-254864620,-791858668,-796061132,-796043740,-796141978,-796270874,-761750602,-757561210,-226977658,1916508294,1916451982,1914414238,1914216634,1914233016,1914392808,1897529448,1880752428,1881028412,1887385108,-788580812,-795009488,-795009488,-795009488,-795067872,-744957328,-761754031,-757494078,-757361790,-757485434,-765943642,1379442926,1916309742,1916587246,1914591454,1914583246,857614734,828324495,811482765,819869327,1889145486,1891259038,1891357358,1891407590,1941742886,1929161782,1920773174,1920840759,1916710951,1916723239,1916694573,1899892829,1885222345,1885219736,1893612216,1893665448,818678441,818154153,810822281,810821257,812925579,821412505,296149741,329753316,1390780960,1390715696,1919198512,1919202336,1919259697,1919401009,1936108547,-781783802,-781289466,-798095338,-797173722,-799270810,-799471130,-791015530,-795191674,-778382713,-746024249,-762805417,-761757641,-765685721,-769806297,-750850009,1899950143,1882615819,1880500555,1884695259,1893145273,836045499,869534395,852769673,844378505,844366217,844431771,290861738,1358848682,1354687214,1354602070,1908186626,1940438802,1927855414,1923658789,1923789877,1927979028,2003476500,1966010420,1950314532,1948004396,1948131817,1959672489,1955990203,1888881306,2006260362,1993632394,1918136202,1913942154,1913966730,1918156938,1946079466,1911218218,1894424874,1626055467,1626062600,-521430264,-521553656,-530007784,-450323672,-416568792,-433392120,-416415160,-416415029,-416414994,-412417298,-408419730,-425192410,-425171962,-425139194,-156590073,-152395771,-164913147,-181828608,-735392736,-735426528,-1803663071,-1862391241,-1868682745,-1851901434,-1835594170,-1835725242,-762048906,-762045338,-757830425,-766221083,-770411315,-216612724,-216104572,-249658748,-217144652,-217796683,-482047531,-515602092,-536372940,-536434140,-1609110988,-1607045609,-1267253706,-1259008474,-1258483930,-1216602842,-1224993434,-1230499614,-1230417694,-1230352233,-1230376828,-135470972,-180552572,-784480092,-803288924,-803309404,-266458219,-245486906,-740413754,-1818356025,-1749220667,-1751375243,-1782832603,-1799593435,-1866640860,-1867757980,-1796727203,-1788339634,-1757934730,-1757718426,-679908250,-679936970,-730272754,-730207218,-713380595,-673542372,-677736652,-1768256140,-1772560944,-1759975984,-1625758223,-1659176989,-1644505373,-1782917149,-1782593565,-1782807613,-1778548413,-1786867455,-1791509487,-197855199,-197859295,-197859293,-180979662,-148998078,-161598270,-161873470,1918435730,1918435750,1926828455,1921525677,1938303933,1938295484,835193516,828316332,1880500924,1882533517,1882461833,1885603465,820340379,816312063,296070733,330079813,313312789,1387067237,1387062567,1391391783,1382988834,1378278434,1394986034,1394994178,1366228226,1370414338,1353633091,1353571811,-798200413,-802394713,-801317401,-801208713,-251755001,-239172089,1940172551,1923394615,1927591983,1919204399,1915655215,1916715071,1931362399,1930297501,1896232381,1883646653,1640438461,1908742845,1908677293,1904487100,1909728908,1909744332,1909846732,1912066780,1375060724,1400686324,-748893728,-765671327,-757315357,-755082014,-760601390,1403658434,1357521090,1089085890,1089147762,1088946726,1080558118,1076383278,1076423182,1076668942,1345235470,1345231630,1366198542,1407683790,1457815774,1458876526,1450483758,1916067887,1914101801,1930846489,1964391256,1951873640,1951734504,1968446185,1976835067,1909734859,1910255947,1373110603,1356464763,1352282730,1352360686,-778439961,-742873370,-755457354,-765943310,1376293106,1380552727,1405796365,1369096216,1356472376,1350181944,1345005624,1344998264,1345198776,1345206920,1374435976,329779849,313016971,313033115,313037242,1386918314,1378787754,1378853354,1378722154,304981262,305130502,309329159,334462262,334386470,1408136998,1399203630,1366242590,1097604366,1106839822,1085868298,-994506438,-994493638,-994493638,-861393094,-861396422,-844602822,-878157253,-877927879,-878063064,-1947693080,-1989637144,-1926723144,-1943299640,-1943356472,-1942312376,-2076530164,-2074366388,-2066176260,-2070355268,-2137480540,-2118405212,-2118483807,-2114288478,-2114220910,-2122737518,-2143446094,-2143446286,-1875985838,-1875990014,-1339118846,-1284854526,-219431886,-156263405,-151143424,-163800064,1983699984,1983667232,1983781924,910044196,910042148,645801252,649989652,918179524,1940541124,1890307716,1353318020,1357475712,1349069713,1349196438,1357580966,1353259686,1890073254,1890069158,1906847414,1390946182,1383605639,1379402133,1379418532,305951180,305951053,309080329,317011289,329673593,296118891,283540346,275143642,271010762,271384010,1076420938,1097384202,1105772842,1101574442,1151967530,1152098602,-978672342,-844520166,-811031271,-827792071,-1968442055,-1964325591,-1955951319,-1993634311,-1921282567,-1669617192,-1661228584,-1662276712,-1662271560,-1796504136,-1805090660,-1809268596,-1876365132,-1876270684,-1872092447,-1863698718,-1846931870,-772994542,-781448702,-785630718,-752145918,-768743342,-231953182,-230902606,-495151994,1658619014,1653378502,1653378935,1648735525,1645715500,1645666348,1647730732,1648255016,1648242728,1669209112,549324872,1623083464,1622854281,1621875337,1894345352,1885873800,1881682568,1881670329,1902777005,1907241645,1370366629,1370235571,1370235283,1352933522,1084629122,1088827586,1080482818,1075874066,1075886370,1080340258,1101311523,1101381137,1134993152,1206294848,1197902192,-953759279,-819476159,-819659439,-849025229,-840915166,-861559518,-861498078,-857223902,-849031886,-849020590,-814945838,-805508622,-822317662,-830915166,-834789982,-834794061,-949088815,-949088320,-974307520,1173105600,1172597744,1172597728,1172732849,1172708243,1172770226,1164201442,1159757282,1142963682,1142959426,1143172931,1143141633,1147319600,1164088352,1172407568,1172415745,1201782529,1205968691,1172355875,1163967458,1433467874,-713860702,-713945182,-982382686,-940423710,-941534862,-975117053,-983505663,-983519999,-715084527,-673076960,-677201120,-693728400,-689533248,-697380992,-684781695,1429024145,-735826781,-736088925,-736090911,-731896479,-709884639,-693094656,1453385216,1184933376,-962482687,-962478541,-941507037,-986595613,-986477661,-986543693,-986543742,-990721661,-722248317,-722260542,-731828926,-1004526302,-1004522206,-983562974,-941489150,-941478910,-941413374,-957272830,-957261534,-942647006,-2021622942,-2021627165,-2021372255,-2088317296,-2088319360,-2087270784,-2016352608,-2028939615,-2028943647,-2026638046,-952965870,-954045182,-953783038,-949584638,-949596926,1164856771,1173309825,1155881137,1147459745,1143011488,1144040625,1144100225,1148289411,1165009842,1163961315,-719280351,-719275232,-719209696,-681330128,-673080784,-1277060560,-1293763056,-1293766144,-1834843647,-1830633006,-1838922590,-1843131230,-1825830750,-1876031326,-1876031342,-1863447421,-1868153407,-1868222976,-2136723967,-2136707581,-1046188542,-1012629982,-1016832222,-1037808350,-1037693726,-1037693822,-1019860862,1131817090,1129797811,1096112545,1091598769,1074814336,1166720,3393425,6350753,1080094691,1080094563,1080094497,1080097569,1105238817,1138794016,1117885952,-1029524992,-962416127,-958220541,-958227149,-966555358,-949642910,-714688046,-999892606,1149127042,1144851842,1278480818,1276391842,1144005090,-999284382,-974117854,-810540030,1202725890,1186161666,1186125059,1186104832,-944599360,-944403808,-979060064,-982209888,-1005548896,-2079158352,-1006468208,-1005345808,-720312861,-684708382,1462774246,1449343458,1390549218,-761131870,-761134894,1407320386,1096941827,1092702469,1092640532,1092643636,1105226608,1101167571,1101167490,1139989378,-1049442366,-1050639374,-1050640030,-782195934,1407231522,1386262066,1990241843,1990245681,1986116659,1982256179,1915094115,1932396707,1882065059,1881540786,610409138,614533798,614537910,882916998,882910914,362819074,393243939,388036899,371439905,912431393,912428848,929210112,938651136,1056096000,1045601280,1043504129,506715153,505429025,1579166753,1445082145,1474434913,1419906785,1554124481,1554451137,-995861823,-995825039,-995825117,-990582237,-990876109,1148595778,1144395714,-998896254,-998896494,1156910242,1173380258,1198652595,1182002307,1179880899,1188073171,1204874849,1198583393,1295051552,-852432096,-852453088,-579814624,-537875696,-541939968,-692931840,-692940288,1386381571,1386448114,1382045858,1377843362,1394870434,1344735394,1344669858,1348865938,1353844353,279975552,295710400,60845568,44084752,1134603568,1134734593,1168286978,1151513858,1155712786,1147391522,1143201314,1159912994,1193467730,1327693250,1298324931,1298320579,1298255091,1277226467,1278275043,1278275057,1276182369,1297149729,1339092257,1324414241,1190327553,1189262593,1189253377,-958230271,-941457151,-706312847,-731541519,-735076368,-1808823344,-1808823344,-1805256240,-1788483216,-1755022048,-1763698911,-1763691998,-1633672670,-1616698830,-1646189966,-1646259598,-1663024158,-1663023966,-1663017806,-1662691179,-1671145276,-1658566464,-1657808704,-1624315456,-1624315440,-1624775472,-1620786880,-547044528,-538521008,-542711232,-542973245,-543010110,-1650440478,-1646241374,-1654630234,-1654634330,-1138468674,-47879986,-47814450,-9507505,-546380339,-546938420,-546868779,-579841801,-579841561,-579840666,-590250138,-573477066,-573350394,-575512826,-1615659770,-1650270954,-1646211802,-1654325977,-1654345945,-1658548417,-1620670913,-1628012001,-1630096881,-1747475707,-1781169292,-1806399516,-1672157212,-1139474524,-1137194012,-1138570780,-1088272048,-30254848,-562944000,-562877440,1592796209,1582309410,1578577970,1310064674,1327366434,1291716066,1153044354,-995423357,1151945344,1152096896,-995378560,-995382640,-945181040,-961679727,-961749342,-961785950,-966493022,-953931614,-954193695,-987681600,-852333504,-852300544,-869073408,1282657792,1307639296,1302391315,1302395426,-844039902,-814688222,-814625758,-952972206,-952970046,-950880893,-959273599,-961110143,-961044559,-692745309,-689137181,-697779997,-685131741,-718759887,-735511504,-735566832,-198368208,-198301920,-723118560,-727251423,-727710174,-710926782,-710922558,-975164990,-986445678,-988542830,-1002174334,1161824386,1161976194,1296199106,1330834690,1341191442,1319413538,1319413536,1319939872,1324134176,1311284000,1244236064,1244301584,1245358080,1316661248,-830817279,-830829567,-566522573,-701919517,-718688605,-735334765,-600977789,1546472081,1550650017,1545932193,-597680989,-731890525,1440752866,1470309586,1470309570,396371138,94449026,10632579,11672961,15867328,5315920,3234080,2128672,2120481,23124513,48553491,48674563,48666371,48727809,48547681,61132193,1101328289,1088875440,1088875392,1088876160,1106693761,1140248449,1114869171,1113623779,1109698659,1109698594,1109715234,1126488370,1126684979,1197931827,1172765955,1168538883,-978891517,-974885597,-840930014,-849089246,-840540910,-840545022,1302726978,1302543298,1306598387,1306540961,1163934625,1159928721,1160908161,1160840625,1160794273,1160831201,1160815713,1165012256,1172356368,1168357648,1168293120,1168285440,1206028032,-941455872,-949909967,-949963165,-948897950,-965678238,-940541470,1206983074,1207114162,1165171122,1098202547,1093940631,1075843463,1075974535,2240963,23225667,23125331,23125283,65055011,65055011,31504720,31636800,1080204544,1080200960,1076006416,1096846880,1105260064,1134618128,1134652945,1134636770,1134569890,1138825378,1130612898,1126337682,1092781186,1092792514,1365483778,1365356802,1348515618,1348513570,287337251,354695971,354892065,354818401,354553120,368181552,362950912,362877189,94392593,98610465,98609441,99658017,231971153,264407489,264406401,264405377,1204995457,1163055025,1158868896,1157688288,1161939952,1203949376,1200811584,1318184448,-829364431,-827267293,-823073438,-814490142,-982266398,-1003304558,-1003304574,-1003304062,-999032174,-974029134,1206972339,1198581171,1181808113,-702483087,-685727711,-681533407,-706698973,-706366173,-706243273,-714697449,-714171129,-714171129,-714171129,-714154729,-714160841,-714095305,-713042569,-713046665,-713042441")

(visualise raw-fingerprint)

)
